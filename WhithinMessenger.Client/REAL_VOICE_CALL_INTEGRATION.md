# üéØ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ –∑–≤–æ–Ω–∫–∞ - –ó–ê–í–ï–†–®–ï–ù–û

## ‚úÖ **–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:**

### 1. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è ChatVoiceCall –≤ HomePage**
- –î–æ–±–∞–≤–ª–µ–Ω–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ `activeChatCall` –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∑–≤–æ–Ω–∫–∞
- –°–æ–∑–¥–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `handleJoinVoiceChannel` –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –∑–≤–æ–Ω–∫–∞
- –°–æ–∑–¥–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `handleEndChatCall` –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–≤–æ–Ω–∫–∞

### 2. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ ChatRoom**
- –î–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–æ–ø—ã `activeChatCall` –∏ `onEndChatCall`
- –û–±–Ω–æ–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ `isCallActiveInThisChat` –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –Ω–æ–≤–æ–≥–æ –∑–≤–æ–Ω–∫–∞
- ChatVoiceCall —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ `activeChatCall`

### 3. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å–∏—Å—Ç–µ–º—ã –∑–≤–æ–Ω–∫–æ–≤**
- ChatVoiceCall –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `useGlobalCall` –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–≤–æ–Ω–∫–∞–º–∏
- –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å–∏—Å—Ç–µ–º–æ–π WebRTC –∏ Mediasoup
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏: –º–∏–∫—Ä–æ—Ñ–æ–Ω, —à—É–º–æ–ø–æ–¥–∞–≤–ª–µ–Ω–∏–µ, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥—Ä–æ–º–∫–æ—Å—Ç—å—é

## üîß **–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**

### **–ü–æ—Ç–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:**
1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É –∑–≤–æ–Ω–∫–∞** –≤ —á–∞—Ç–µ
2. **handleStartCall** –≤—ã–∑—ã–≤–∞–µ—Ç `handleCallWithoutNotification`
3. **handleCallWithoutNotification** —Å–æ–∑–¥–∞–µ—Ç `callData` –∏ –≤—ã–∑—ã–≤–∞–µ—Ç `onJoinVoiceChannel`
4. **HomePage.handleJoinVoiceChannel** —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `activeChatCall`
5. **ChatRoom** –ø–æ–ª—É—á–∞–µ—Ç `activeChatCall` –∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç `ChatVoiceCall`
6. **ChatVoiceCall** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç –∑–≤–æ–Ω–æ–∫ —á–µ—Ä–µ–∑ `useGlobalCall`

### **–ö–æ–¥ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:**

#### **HomePage.jsx:**
```javascript
// –°–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∑–≤–æ–Ω–∫–∞ –≤ —á–∞—Ç–µ
const [activeChatCall, setActiveChatCall] = useState(null);

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–≤–æ–Ω–∫–æ–≤ –≤ —á–∞—Ç–∞—Ö
const handleJoinVoiceChannel = useCallback((callData) => {
  console.log('HomePage: handleJoinVoiceChannel called with:', callData);
  
  // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∑–≤–æ–Ω–æ–∫ –≤ —á–∞—Ç–µ
  setActiveChatCall({
    chatId: callData.chatId,
    chatName: callData.roomName,
    userId: callData.userId,
    userName: callData.userName
  });
  
  console.log('HomePage: Voice call started in chat:', callData.roomName);
}, []);
```

#### **ChatRoom.jsx:**
```javascript
const isCallActiveInThisChat = (activePrivateCall && 
  String(activePrivateCall.chatId) === String(chatId) && 
  isPrivateChat) || (activeChatCall && 
  String(activeChatCall.chatId) === String(chatId));

{isCallActiveInThisChat && (
  <ChatVoiceCall
    chatId={chatId}
    chatName={activeChatCall?.chatName || groupName}
    userId={activeChatCall?.userId || userId}
    userName={activeChatCall?.userName || username}
    onClose={() => {
      if (onEndChatCall) {
        onEndChatCall();
      }
    }}
  />
)}
```

## üéÆ **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**

### **ChatVoiceCall –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç:**
- ‚úÖ **–ú–∏–∫—Ä–æ—Ñ–æ–Ω** - –≤–∫–ª—é—á–µ–Ω–∏–µ/–≤—ã–∫–ª—é—á–µ–Ω–∏–µ
- ‚úÖ **–®—É–º–æ–ø–æ–¥–∞–≤–ª–µ–Ω–∏–µ** - RNNoise –∏ Speex
- ‚úÖ **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥—Ä–æ–º–∫–æ—Å—Ç—å—é** - –≥–ª–æ–±–∞–ª—å–Ω–æ–µ –∏ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–µ
- ‚úÖ **–£—á–∞—Å—Ç–Ω–∏–∫–∏** - –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –∑–≤–æ–Ω–∫–∞
- ‚úÖ **–ù–∞—Å—Ç—Ä–æ–π–∫–∏** - —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–≤–æ–Ω–∫–∞
- ‚úÖ **–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ** - –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∑–≤–æ–Ω–∫–∞

### **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å–∏—Å—Ç–µ–º–æ–π:**
- ‚úÖ **useGlobalCall** - –≥–ª–æ–±–∞–ª—å–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º
- ‚úÖ **WebRTC** - —Ä–µ–∞–ª—å–Ω–æ–µ –∞—É–¥–∏–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
- ‚úÖ **Mediasoup** - –º–µ–¥–∏–∞ —Å–µ—Ä–≤–µ—Ä
- ‚úÖ **Zustand** - –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
- ‚úÖ **–§–æ–Ω–æ–≤—ã–µ –∑–≤–æ–Ω–∫–∏** - –∑–≤–æ–Ω–æ–∫ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏

## üöÄ **–ì–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é!**

–¢–µ–ø–µ—Ä—å –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É –∑–≤–æ–Ω–∫–∞ –≤ —á–∞—Ç–µ:
1. **–ó–∞–ø—É—Å—Ç–∏—Ç—Å—è —Ä–µ–∞–ª—å–Ω—ã–π –≥–æ–ª–æ—Å–æ–≤–æ–π –∑–≤–æ–Ω–æ–∫**
2. **–û—Ç–æ–±—Ä–∞–∑–∏—Ç—Å—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å ChatVoiceCall**
3. **–ó–≤–æ–Ω–æ–∫ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –≤ —Ñ–æ–Ω–µ**
4. **–í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–Ω—ã**

## üß™ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**

1. **–û—Ç–∫—Ä–æ–π—Ç–µ —á–∞—Ç 1 –Ω–∞ 1**
2. **–ù–∞–∂–º–∏—Ç–µ –∑–µ–ª–µ–Ω—É—é –∫–Ω–æ–ø–∫—É –∑–≤–æ–Ω–∫–∞**
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–æ—è–≤–∏–ª—Å—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∑–≤–æ–Ω–∫–∞**
4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫**
5. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∑–≤–æ–Ω–æ–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ñ–æ–Ω–µ**

–ó–≤–æ–Ω–æ–∫ —Ç–µ–ø–µ—Ä—å –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å–∏—Å—Ç–µ–º–æ–π!





